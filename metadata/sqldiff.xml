<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqldiff PUBLIC "-//OpenMRS//DTD OpenMRS SQL Diff Config 1.0//EN" "http://resources.openmrs.org/doctype/sqldiff-1.0.dtd">

<sqldiff version="1.0">
	<help>
		USE:
			The diffs are ordered by datamodel version number.
			The script can be run in a top down fashion and is
			expected to not fail or overwrite old data
		
		EXPECT:
			- "use business-database-name;" was called prior to
			   calling this script
	</help>
	
	<diff>
		<version>1.0</version>
		<author>Dieterich Lawson</author>
		<date>March 14th 2010</date>
		<description>
			
		</description>
		<sql>
			CREATE TABLE IF NOT EXISTS messaging_addresses (
			  `address_id` int(11) NOT NULL auto_increment,
			  `retired` tinyint(1) NOT NULL default '0',
			  `address` varchar(255) NOT NULL default '',
			  `password` varchar(255) default '',
			  PRIMARY KEY  (address_id)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8;
		
			CREATE TABLE IF NOT EXISTS messaging_messages (
			  `message_id` int(11) NOT NULL auto_increment,
			  `content` varchar(600) default '',
			  `origin_address` int(11) default '0',
			  `destination_address` int(11) default '0',
			  `date_sent` datetime default NULL,
			  `date_received` datetime default NULL,
			  `status` int(11) default '0',
			  PRIMARY KEY  (`message_id`),
			  CONSTRAINT `Address that this message is from` FOREIGN KEY (`origin_address`) REFERENCES `messaging_addresses` (`address_id`),
			  CONSTRAINT `Address that this message is to` FOREIGN KEY (`destination_address`) REFERENCES `messaging_addresses` (`address_id`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8;
		
			ALTER TABLE person_attribute_type MODIFY format varchar(100);
		
			INSERT INTO person_attribute_type 
				(name, description, format, creator, date_created, uuid) 
				VALUES ('Messaging Address', 'messaging address of the person', 'org.openmrs.module.messaging.schema.MessageAddress', 1, now(), UUID());
		
			INSERT INTO person_attribute_type 
				(name, description, format, creator, date_created, uuid) 
				VALUES ('Preferred Messaging Address', 'the preferred messaging address of the person', 'org.openmrs.module.messaging.schema.MessageAddress', 1, now(), UUID());
				
		</sql>
	</diff>
	
</sqldiff>